<?xml version="1.0" encoding="UTF-8"?>
<jtlshopplugin>
    <Name>Customer Returns</Name>
    <Description>Vollständiges Retouren-Management-System für JTL Shop 5 - Kunden können Retouren ohne Login über Bestellnummer und E-Mail initiieren.</Description>
    <Author>Development Team</Author>
    <URL>https://github.com/LiL-Loco/rma</URL>
    <XMLVersion>100</XMLVersion>
    <ShopVersion>5.0.0</ShopVersion>
    <PluginID>jtl_customer_returns</PluginID>
    <Version>1.0.0</Version>
    <CreateDate>2025-10-17</CreateDate>
    <LastUpdate>2025-10-17</LastUpdate>
    <Icon>fa-undo</Icon>
    
    <!-- Installation -->
    <Install>
        <FrontendLink>
            <Link>
                <Filename>return_page.php</Filename>
                <Name>Retoure anlegen</Name>
                <Template>frontend/templates/return_form.tpl</Template>
                <VisibleAfterLogin>N</VisibleAfterLogin>
                <PrintButton>N</PrintButton>
                <SSL>2</SSL>
                <LinkGroup>Fuss</LinkGroup>
                <LinkLanguage iso="GER">
                    <Seo>retoure-anlegen</Seo>
                    <Name>Retoure anlegen</Name>
                    <Title>Retoure anlegen</Title>
                    <MetaTitle>Retoure anlegen - Artikel zurücksenden</MetaTitle>
                    <MetaKeywords>Retoure,Rücksendung,Umtausch,Rückgabe</MetaKeywords>
                    <MetaDescription>Retoure einfach und bequem online anmelden</MetaDescription>
                </LinkLanguage>
            </Link>
        </FrontendLink>
        
        <Adminmenu>
            <Customlink sort="1">
                <Name>Retouren-Übersicht</Name>
            </Customlink>
            
            <Customlink sort="2">
                <Name>Statistiken</Name>
            </Customlink>
            
            <Settingslink sort="3">
                <Name>Einstellungen</Name>
                <!-- Retourenbedingungen -->
                <Setting type="number" initialValue="14" sort="1" conf="Y">
                    <Name>Retourenfrist (Tage)</Name>
                    <Description>Anzahl Tage nach Versand, in denen Retouren möglich sind</Description>
                    <ValueName>return_period_days</ValueName>
                </Setting>
                
                <Setting type="selectbox" initialValue="N" sort="2" conf="Y">
                    <Name>Versandkosten automatisch erstatten</Name>
                    <Description>Versandkosten bei Retoure automatisch zurückerstatten</Description>
                    <ValueName>auto_refund_shipping</ValueName>
                    <SelectboxOptions>
                        <Option value="Y" sort="1">Ja</Option>
                        <Option value="N" sort="2">Nein</Option>
                    </SelectboxOptions>
                </Setting>
                
                <!-- Retourenlabel -->
                <Setting type="selectbox" initialValue="N" sort="10" conf="Y">
                    <Name>Retourenlabel automatisch erstellen</Name>
                    <Description>Retourenlabel bei RMA-Erstellung automatisch generieren</Description>
                    <ValueName>auto_create_label</ValueName>
                    <SelectboxOptions>
                        <Option value="Y" sort="1">Ja</Option>
                        <Option value="N" sort="2">Nein</Option>
                    </SelectboxOptions>
                </Setting>
                
                <Setting type="selectbox" initialValue="dhl" sort="11" conf="Y">
                    <Name>Versanddienstleister</Name>
                    <Description>Versanddienstleister für Retourenlabel</Description>
                    <ValueName>shipping_provider</ValueName>
                    <SelectboxOptions>
                        <Option value="dhl" sort="1">DHL</Option>
                        <Option value="dpd" sort="2">DPD</Option>
                        <Option value="ups" sort="3">UPS</Option>
                        <Option value="hermes" sort="4">Hermes</Option>
                    </SelectboxOptions>
                </Setting>
                
                <Setting type="text" initialValue="" sort="12" conf="Y">
                    <Name>Versanddienstleister API-Key</Name>
                    <Description>API-Schlüssel für Retourenlabel-Erstellung</Description>
                    <ValueName>shipping_api_key</ValueName>
                </Setting>
                
                <!-- Produktausschlüsse -->
                <Setting type="text" initialValue="" sort="20" conf="Y">
                    <Name>Ausgeschlossene Kategorien</Name>
                    <Description>Kategorie-IDs (kommagetrennt), die von Retouren ausgeschlossen sind</Description>
                    <ValueName>excluded_categories</ValueName>
                </Setting>
                
                <Setting type="textarea" initialValue="" sort="21" conf="Y">
                    <Name>Ausgeschlossene Artikel-Nummern</Name>
                    <Description>Artikel-Nummern (kommagetrennt), die nicht retourniert werden können</Description>
                    <ValueName>excluded_product_nos</ValueName>
                </Setting>
                
                <!-- Benachrichtigungen -->
                <Setting type="text" initialValue="" sort="30" conf="Y">
                    <Name>Admin-Benachrichtigungs-E-Mail</Name>
                    <Description>E-Mail-Adresse für Admin-Benachrichtigungen (neue RMAs, Fehler)</Description>
                    <ValueName>admin_notification_email</ValueName>
                </Setting>
                
                <Setting type="selectbox" initialValue="Y" sort="31" conf="Y">
                    <Name>Admin bei neuer Retoure benachrichtigen</Name>
                    <Description>E-Mail an Admin senden, wenn neue Retoure erstellt wird</Description>
                    <ValueName>notify_admin_on_new_rma</ValueName>
                    <SelectboxOptions>
                        <Option value="Y" sort="1">Ja</Option>
                        <Option value="N" sort="2">Nein</Option>
                    </SelectboxOptions>
                </Setting>
                
                <!-- Wawi-Synchronisation -->
                <Setting type="number" initialValue="15" sort="40" conf="Y">
                    <Name>Wawi-Sync-Intervall (Minuten)</Name>
                    <Description>Intervall in Minuten für automatische Wawi-Synchronisation</Description>
                    <ValueName>wawi_sync_interval</ValueName>
                </Setting>
                
                <Setting type="selectbox" initialValue="Y" sort="41" conf="Y">
                    <Name>Automatische Wawi-Synchronisation</Name>
                    <Description>RMAs automatisch mit JTL-Wawi synchronisieren</Description>
                    <ValueName>wawi_auto_sync</ValueName>
                    <SelectboxOptions>
                        <Option value="Y" sort="1">Ja</Option>
                        <Option value="N" sort="2">Nein</Option>
                    </SelectboxOptions>
                </Setting>
                
                <!-- Rücksendeadresse -->
                <Setting type="textarea" initialValue="" sort="50" conf="Y">
                    <Name>Rücksendeadresse</Name>
                    <Description>Adresse, an die Retouren gesendet werden sollen (mehrzeilig)</Description>
                    <ValueName>shop_return_address</ValueName>
                </Setting>
            </Settingslink>
        </Adminmenu>
        
        <Emailtemplate>
        <!-- 1. Retouren-Bestätigung -->
        <Template>
            <Name>Retouren-Bestätigung</Name>
            <Description>E-Mail bei RMA-Erstellung</Description>
            <Type>text/html</Type>
            <ModulId>jtl_customer_returns_confirmation</ModulId>
            <Active>Y</Active>
            <TemplateLanguage iso="GER">
                <Subject>Ihre Retoure {$rma_number} wurde registriert</Subject>
                <ContentHtml><![CDATA[
{includeMailTemplate template=header type=html}
<p>Sehr geehrte/r {$customer_name},</p>
<p>Ihre Retoure mit der Nummer <strong>{$rma_number}</strong> wurde erfolgreich registriert.</p>

<h3>Retournierte Artikel:</h3>
<table style="width: 100%; border-collapse: collapse;">
    <thead>
        <tr style="background-color: #f5f5f5;">
            <th style="padding: 8px; border: 1px solid #ddd;">Artikel</th>
            <th style="padding: 8px; border: 1px solid #ddd;">Menge</th>
            <th style="padding: 8px; border: 1px solid #ddd;">Grund</th>
        </tr>
    </thead>
    <tbody>
        {foreach $return_items as $item}
        <tr>
            <td style="padding: 8px; border: 1px solid #ddd;">{$item.name}</td>
            <td style="padding: 8px; border: 1px solid #ddd;">{$item.quantity}</td>
            <td style="padding: 8px; border: 1px solid #ddd;">{$item.reason}</td>
        </tr>
        {/foreach}
    </tbody>
</table>

<h3>Rücksendeadresse:</h3>
<div style="background-color: #f9f9f9; padding: 15px; border: 1px solid #ddd;">
{$return_address}
</div>

<p>Bitte senden Sie die Artikel an die oben genannte Adresse zurück.</p>
<p>Sie erhalten eine weitere E-Mail, sobald Ihre Retoure bearbeitet wurde.</p>

{includeMailTemplate template=footer type=html}
                ]]></ContentHtml>
                <ContentText><![CDATA[
Sehr geehrte/r {$customer_name},

Ihre Retoure mit der Nummer {$rma_number} wurde erfolgreich registriert.

Bitte senden Sie die Artikel an folgende Adresse zurück:
{$return_address}

Sie erhalten eine weitere E-Mail, sobald Ihre Retoure bearbeitet wurde.
                ]]></ContentText>
            </TemplateLanguage>
        </Template>
        
        <!-- 2. Status-Update -->
        <Template>
            <Name>Retouren-Status-Update</Name>
            <Description>E-Mail bei Status-Änderung</Description>
            <Type>text/html</Type>
            <ModulId>jtl_customer_returns_status_update</ModulId>
            <Active>Y</Active>
            <TemplateLanguage iso="GER">
                <Subject>Ihre Retoure {$rma_number} - Status: {$new_status}</Subject>
                <ContentHtml><![CDATA[
{includeMailTemplate template=header type=html}
<p>Sehr geehrte/r {$customer_name},</p>
<p>Der Status Ihrer Retoure <strong>{$rma_number}</strong> hat sich geändert.</p>

<div style="background-color: #e3f2fd; padding: 15px; border-left: 4px solid #2196f3;">
    <strong>Neuer Status:</strong> {$new_status}
</div>

{if $admin_comment}
<h3>Kommentar:</h3>
<p>{$admin_comment}</p>
{/if}

<p>Bei Fragen stehen wir Ihnen gerne zur Verfügung.</p>

{includeMailTemplate template=footer type=html}
                ]]></ContentHtml>
            </TemplateLanguage>
        </Template>
        
        <!-- 3. Gutschein -->
        <Template>
            <Name>Retouren-Gutschein</Name>
            <Description>E-Mail bei Gutscheinerstellung</Description>
            <Type>text/html</Type>
            <ModulId>jtl_customer_returns_voucher</ModulId>
            <Active>Y</Active>
            <TemplateLanguage iso="GER">
                <Subject>Ihr Gutschein für Retoure {$rma_number}</Subject>
                <ContentHtml><![CDATA[
{includeMailTemplate template=header type=html}
<p>Sehr geehrte/r {$customer_name},</p>
<p>Für Ihre Retoure <strong>{$rma_number}</strong> wurde ein Gutschein erstellt:</p>

<div style="background-color: #fff3cd; padding: 20px; border: 2px dashed #ffc107; text-align: center;">
    <h2 style="margin: 0 0 10px 0;">Gutscheincode</h2>
    <p style="font-size: 24px; font-weight: bold; margin: 10px 0;">{$voucher_code}</p>
    <p><strong>Wert:</strong> {$voucher_amount|number_format:2} €</p>
    <p><strong>Gültig bis:</strong> {$voucher_expires|date_format:"%d.%m.%Y"}</p>
</div>

<p>Sie können den Gutschein im Warenkorb einlösen.</p>

{includeMailTemplate template=footer type=html}
                ]]></ContentHtml>
            </TemplateLanguage>
        </Template>
        
        <!-- 4. Rückzahlung -->
        <Template>
            <Name>Retouren-Rückzahlung</Name>
            <Description>E-Mail bei Rückzahlung</Description>
            <Type>text/html</Type>
            <ModulId>jtl_customer_returns_refund</ModulId>
            <Active>Y</Active>
            <TemplateLanguage iso="GER">
                <Subject>Rückzahlung für Retoure {$rma_number} verarbeitet</Subject>
                <ContentHtml><![CDATA[
{includeMailTemplate template=header type=html}
<p>Sehr geehrte/r {$customer_name},</p>
<p>Die Rückzahlung für Ihre Retoure <strong>{$rma_number}</strong> wurde verarbeitet.</p>

<ul>
    <li><strong>Betrag:</strong> {$refund_amount|number_format:2} €</li>
    <li><strong>Zahlungsmethode:</strong> {$payment_method}</li>
    <li><strong>Voraussichtliche Buchung:</strong> {$refund_date|date_format:"%d.%m.%Y"}</li>
</ul>

<p>Die Gutschrift wird in den nächsten 3-5 Werktagen auf Ihrem Konto eingehen.</p>

{includeMailTemplate template=footer type=html}
                ]]></ContentHtml>
            </TemplateLanguage>
        </Template>
        </Emailtemplate>
    </Install>
    
    <!-- Lizenz -->
    <Licence>
        <![CDATA[
MIT License

Copyright (c) 2025 Development Team

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
        ]]>
    </Licence>
</jtlshopplugin>
